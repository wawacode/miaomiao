angular.module("miaomiao.shop").factory("ShoppingCart",["$http","$rootScope","localStorageService","$localStorage","$sessionStorage","$timeout",function(f,a,d,b,e,c){return{_shoppingItems:function(){var g=e.MMMETA_SavedShoppingCartItems||[];return g;},itemExistInCart:function(i,h){for(var g=0;g<h.length;g++){if(i.id==h[g].id){return true;}}return false;},addItemToCart:function(j){var h=this._shoppingItems();var i=-1;for(var g=0;g<h.length;g++){if(j.id==h[g].id){i=g;break;}}if(i==-1){h.push(j);}else{h[i].count=j.count;}e.MMMETA_SavedShoppingCartItems=h;},removeItemFromCart:function(j){var h=this._shoppingItems();var i=-1;for(var g=0;g<h.length;g++){if(j.id==h[g].id){i=g;break;}}if(i>-1){if(j.count<=0){h.splice(i,1);}else{h[i].count=j.count;}}e.MMMETA_SavedShoppingCartItems=h;},getAllItems:function(){return this._shoppingItems();},clearAll:function(){e.MMMETA_SavedShoppingCartItems=[];this.itemChangeEventInShoppingCart();},getCountForItem:function(i){var h=this._shoppingItems();for(var g=0;g<h.length;g++){if(i.id==h[g].id){return h[g].count;}}return 0;},getCountForCategroy:function(j){var h=this._shoppingItems();var i=0;for(var g=0;g<h.length;g++){if(j==h[g].category_id){i+=h[g].count;}}return i;},getTotalCount:function(){var g=this._shoppingItems();var h=0;for(var i=0;i<g.length;i++){h+=parseInt(g[i].count||0);}return h;},getTotalPrice:function(){var g=0;var h=this._shoppingItems();for(var i=0;i<h.length;i++){g+=parseFloat(h[i].price||0)*parseInt(h[i].count||0);}return g/100;},cartReadyToShip:function(){var h=d.get("MMMETA_shop")||{},g=h.base_price||2000;return this.getTotalPrice()>=g/100;},cartNotReadyLeftPrice:function(){var h=d.get("MMMETA_shop")||{},g=h.base_price||2000;return Math.round((g/100-this.getTotalPrice())*100)/100;},itemChangeEventInShoppingCart:function(g){c(function(){a.$broadcast("MMEVENT_ItemSelectionChangedInShoppingCart",{item:g});});},onItemChangeEventInShoppingCart:function(g,h){g.$on("MMEVENT_ItemSelectionChangedInShoppingCart",function(j,i){h(i);});},itemChangeEventInProductList:function(g){c(function(){a.$broadcast("MMEVENT_ItemSelectionChangedInProductList",{item:g});});},onItemChangeEventInProductList:function(g,h){g.$on("MMEVENT_ItemSelectionChangedInProductList",function(j,i){h(i);});}};}]);