angular.module("miaomiao.shop").controller("UserAddressListCtrl",function(k,g,c,i,d,b,f,e,h,j){k.shop=f.get("MMMETA_shop")||{};function a(){k.LoadingMessage="正在加载地址列表...";g.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:k});e.getAddressList(k.shop.id,function(o,l){var m=o.code,n=o.data;if(m!=0){c.alert({title:"加载数据失败:"+o.msg,template:""});return;}g.hide();k.shop=n.shop;k.addressls=n.addressls||[];if(k.addressls&&k.addressls.length){k.addressls[0].isDefault=true;}},function(m,l){k.addressls=[];c.alert({title:"加载数据失败,请刷新",template:""});});}k.goToAddNewAddress=function(){b.go("userAddAddress");};k.setDefaultAddress=function(m){for(var l=0;l<k.addressls.length;l++){k.addressls[l].isDefault=false;}m.isDefault=true;k.LoadingMessage="正在切换默认地址...";g.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:k});e.setDefaultAddress(k.shop.id,m,function(q,n){var o=q.code,p=q.data;if(o!=0){c.alert({title:"切换默认地址:"+q.msg,template:""});return;}g.hide();h.addressChangeEventSwitchDefault(m);b.go("myOrders",null,{reload:true});},function(o,n){g.hide();c.alert({title:"加载数据失败,请刷新",template:""});});};k.addNewAddressConfirm=function(){if(!k.newAddress.address||!k.newAddress.phone||!j.isValidTelNumber(k.newAddress.phone)){c.alert({title:"请填写正确的地址电话",template:""});return;}k.LoadingMessage="正在添加新地址...";g.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:k});e.addAddress(k.shop.id,k.newAddress,function(o,l){var m=o.code,n=o.data;if(m!=0){c.alert({title:"添加新地址失败:"+o.msg,template:""});return;}g.hide();h.addressChangeEventAddNew(k.newAddress);b.go("myOrders",null,{reload:true});},function(m,l){g.hide();c.alert({title:"添加新地址失败,请刷新",template:""});});};k.$on("$ionicView.enter",function(){k.newAddress={};a();});});