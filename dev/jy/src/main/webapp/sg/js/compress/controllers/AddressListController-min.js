angular.module("miaomiao.shop").controller("AddressListCtrl",function(j,f,h,b,c,e,d,g,i){j.shop=e.get("MMMETA_shop");function a(){j.LoadingMessage="正在加载地址列表...";f.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:j});d.getAddressList(j.shop.id,function(n,k){var l=n.code,m=n.data;if(l!=0){c.alert({title:"加载数据失败:"+n.msg,template:""});return;}f.hide();j.shop=m.shop;j.addressls=m.addressls||[];if(j.addressls&&j.addressls.length){j.addressls[0].isDefault=true;}},function(l,k){j.addressls=[];c.alert({title:"加载数据失败,请刷新",template:""});});}j.goToAddNewAddress=function(){b.go("addAddress");};j.setDefaultAddress=function(l){for(var k=0;k<j.addressls.length;k++){j.addressls[k].isDefault=false;}l.isDefault=true;j.LoadingMessage="正在切换默认地址...";f.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:j});d.setDefaultAddress(j.shop.id,l,function(p,m){var n=p.code,o=p.data;if(n!=0){c.alert({title:"切换默认地址:"+p.msg,template:""});return;}f.hide();b.go("checkout",null,{reload:true});g.addressChangeEventSwitchDefault(l);},function(n,m){f.hide();c.alert({title:"加载数据失败,请刷新",template:""});});};j.addNewAddressConfirm=function(){if(!j.newAddress.address||!j.newAddress.phone||!i.isValidTelNumber(j.newAddress.phone)){c.alert({title:"请填写正确的地址电话",template:""});return;}j.LoadingMessage="正在添加新地址...";f.show({templateUrl:"/views/sg/templates/loadingIndicator.html",scope:j});d.addAddress(j.shop.id,j.newAddress,function(n,k){var l=n.code,m=n.data;if(l!=0){c.alert({title:"添加新地址失败:"+n.msg,template:""});return;}f.hide();b.go("checkout",null,{reload:true});g.addressChangeEventAddNew(j.newAddress);},function(l,k){f.hide();c.alert({title:"添加新地址失败,请刷新",template:""});});};j.$on("$ionicView.enter",function(){j.newAddress={};a();});});